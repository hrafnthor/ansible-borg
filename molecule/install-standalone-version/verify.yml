---
- name: Verify
  hosts: all
  gather_facts: yes
  tasks:

  - name: Ensure borg is executable
    command: borg --version
    register: borg_version
    changed_when: false

  - name: Extract borg package version
    set_fact:
      borg_version_cleaned: "{{ borg_version.stdout | regex_replace('[^0-9.-]', '') }}"

  - name: Ensure borg version matches required
    fail:
      msg: "Expected version '1.4.2' but found '{{ borg_version }}'!"
    when:
      - "borg_version_cleaned != '1.4.2'"
